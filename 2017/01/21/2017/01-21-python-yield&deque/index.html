<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> yield 和 deque · Qiyexuxu</title><meta name="description" content="yield 和 deque - David Wang"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://blog.keeplearning.group/atom.xml" title="Qiyexuxu"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/logo.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/abnerwang" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/about" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">yield 和 deque</h1><div class="tags"><a href="/tags/Python/" class="tag-title">#Python</a></div><div class="post-info">Jan 21, 2017</div><div class="post-content"><p><code>yield</code> 相当于 <code>return</code>，是一个生成器，目前知道的就两点：</p>
<ul>
<li>返回一个值，并且记住这个返回的位置，下次迭代就从这个位置后开始</li>
<li>值是一次性的，不可以被反复访问，返回一次后便丢失</li>
</ul>
<p><code>deque(maxlen=N)</code> 创建一个固定长度的队列。当有新纪录加入而队列已满时会自动移除最老的那条记录，当不指定 <code>maxlen</code> 时，则代表创建一个可变长的队列。</p>
<a id="more"></a>
<p>下面的代码对一系列文本做简单的文本匹配操作，当发现又匹配时就输出当前的匹配行以及最后检查到的那一行文本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(lines, pattern, history=<span class="number">5</span>)</span>:</span></span><br><span class="line">    previous_lines = deque(maxlen=history)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        <span class="keyword">if</span> pattern <span class="keyword">in</span> line:</span><br><span class="line">            <span class="keyword">yield</span> line, previous_lines</span><br><span class="line">        previous_lines.append(line)</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># Example use on a file</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">with</span> open(<span class="string">'somefile.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> line, prevlines <span class="keyword">in</span> search(f, <span class="string">'python'</span>, <span class="number">5</span>):</span><br><span class="line">            <span class="keyword">for</span> pline <span class="keyword">in</span> prevlines:</span><br><span class="line">                print(pline, end=<span class="string">''</span>)</span><br><span class="line">            print(line, end=<span class="string">''</span>)</span><br><span class="line">            print(<span class="string">'-'</span> * <span class="number">20</span>)</span><br></pre></td></tr></table></figure>
<p>somefile.txt 文件内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">This is a test file.</span><br><span class="line">This is a test file.</span><br><span class="line">This is a test file.</span><br><span class="line">This is a test file.</span><br><span class="line">This is a test file.</span><br><span class="line">This is a test file.</span><br><span class="line">This is a test file.</span><br><span class="line">This is a test file.</span><br><span class="line">This is a test file.</span><br><span class="line">This is a test file.</span><br><span class="line">This is a test file.</span><br><span class="line">This is a test file.</span><br><span class="line">This is a test file.</span><br><span class="line">This is a test file.</span><br><span class="line">This is a python test file.</span><br><span class="line">This is a python test file.</span><br><span class="line">This is a python test file.</span><br><span class="line">This is a python test file.</span><br><span class="line">This is a python test file.</span><br><span class="line">This is a python test file.</span><br><span class="line">This is a python test file.</span><br></pre></td></tr></table></figure>
<p>最后的输出结果为：</p>
<p><img src="http://wx1.sinaimg.cn/mw690/79225320gy1felyzlxnjyj20sg0hsq5q.jpg" alt=""></p>
<p>对于 <code>deque</code>，可以在两端执行添加和弹出操作：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"> </span><br><span class="line">q = deque()</span><br><span class="line">q.append(<span class="number">1</span>)</span><br><span class="line">q.appendleft(<span class="number">2</span>)</span><br><span class="line">q.append(<span class="number">3</span>)</span><br><span class="line">print(q)        <span class="comment"># deque([2, 1, 3])</span></span><br><span class="line">print(q.pop())   <span class="comment"># 3</span></span><br><span class="line">print(q.popleft())   <span class="comment"># 2</span></span><br></pre></td></tr></table></figure>
<hr>
<p>参考：<a href="https://book.douban.com/subject/26381341/" target="_blank" rel="noopener">《Python Cookbook》</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/2017/01/22/2017/01-22-python-heapq&amp;lambda/" class="prev">上一篇</a><a href="/2017/01/18/2017/01-18-python-iterable/" class="next">下一篇</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'abnerwang';
var disqus_identifier = '2017/01/21/2017/01-21-python-yield&amp;deque/';
var disqus_title = 'yield 和 deque';
var disqus_url = 'http://blog.keeplearning.group/2017/01/21/2017/01-21-python-yield&amp;deque/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//abnerwang.disqus.com/count.js" async></script><div class="copyright"><p>© 2014 - 2018 <a href="http://blog.keeplearning.group">David Wang</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>